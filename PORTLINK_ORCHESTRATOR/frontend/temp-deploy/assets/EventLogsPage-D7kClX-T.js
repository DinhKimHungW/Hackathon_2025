import{r as P}from"./rolldown-runtime-CjiBMUN4.js";import{Cn as Y}from"./vendor-BM98ZQOm.js";import"./vendor-charts-C1uJw4t_.js";import"./vendor-utils-BBFcn-gs.js";import{$n as Z,$r as n,Hr as J,Kr as O,Kt as Q,Qn as ee,Rr as se,U as te,Ur as re,V as k,Vr as ae,Vt as E,Xn as ne,Yn as _,Zn as le,Zr as U,ai as r,dr as g,er as a,f as I,fi as ie,hn as de,ln as R,nr as ce,qn as oe,ri as M,rr as A,si as b,tn as z,tr as xe,vi as he,xn as F,zr as ue}from"./vendor-mui-B1q6pdKu.js";import{D as N,E as w,n as je,t as W}from"./index-Bv4sL6jZ.js";import{t as ye}from"./useNotification-CDDMP1HV.js";var p=P(Y()),e=P(he());const pe=({onView:t,onDelete:o})=>{const i=W(),{eventLogs:l,loading:x,pagination:m}=je(s=>s.eventLogs),[h,u]=(0,p.useState)([]),[c,f]=(0,p.useState)(0),[j,v]=(0,p.useState)(50);(0,p.useEffect)(()=>{i(N({page:c+1,limit:j}))},[i,c,j]);const H=s=>{s.target.checked?u(l.map(d=>d.id)):u([])},V=s=>{u(d=>d.includes(s)?d.filter(S=>S!==s):[...d,s])},B=async()=>{window.confirm(`Delete ${h.length} event logs?`)&&(await Promise.all(h.map(s=>i(w(s)))),u([]),i(N({page:c+1,limit:j})))},G=async s=>{window.confirm("Delete this event log?")&&(await i(w(s)),o&&o(s))},$=()=>{const s=[["Time","Event Type","Severity","User","Entity","Description","IP Address"].join(","),...l.map(y=>[y.createdAt,y.eventType,y.severity,y.user?.username||"System",y.entityType||"N/A",`"${y.description.replace(/"/g,'""')}"`,y.ipAddress||"N/A"].join(","))].join(`
`),d=new Blob([s],{type:"text/csv"}),S=URL.createObjectURL(d),C=document.createElement("a");C.href=S,C.download=`event-logs-${I(new Date,"yyyy-MM-dd")}.csv`,C.click(),URL.revokeObjectURL(S)},K=s=>{switch(s){case"INFO":return"info";case"WARNING":return"warning";case"ERROR":return"error";case"CRITICAL":return"error";default:return"default"}},q=s=>{switch(s){case"INFO":return(0,e.jsx)(E,{fontSize:"small"});case"WARNING":return(0,e.jsx)(k,{fontSize:"small"});case"ERROR":return(0,e.jsx)(z,{fontSize:"small"});case"CRITICAL":return(0,e.jsx)(F,{fontSize:"small"});default:return(0,e.jsx)(E,{fontSize:"small"})}},L=s=>({USER_LOGIN:"ðŸ”“ User Login",USER_LOGOUT:"ðŸ”’ User Logout",ASSET_UPDATE:"ðŸ”§ Asset Update",SCHEDULE_CREATE:"ðŸ“… Schedule Created",SCHEDULE_UPDATE:"ðŸ“ Schedule Updated",TASK_CREATE:"âœ… Task Created",TASK_UPDATE:"ðŸ“ Task Updated",SIMULATION_START:"â–¶ï¸ Simulation Started",SIMULATION_COMPLETE:"âœ”ï¸ Simulation Complete",CONFLICT_DETECTED:"âš ï¸ Conflict Detected",CONFLICT_RESOLVED:"âœ… Conflict Resolved",SYSTEM_ERROR:"âŒ System Error",DATA_EXPORT:"ðŸ“¤ Data Export",DATA_IMPORT:"ðŸ“¥ Data Import"})[s]||s,X=s=>h.includes(s),T=h.length;return(0,e.jsxs)(ie,{children:[(0,e.jsx)(le,{sx:{pl:{sm:2},pr:{xs:1,sm:1}},children:T>0?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(r,{sx:{flex:"1 1 100%"},color:"inherit",variant:"subtitle1",children:[T," selected"]}),(0,e.jsx)(g,{title:"Delete",children:(0,e.jsx)(b,{onClick:B,children:(0,e.jsx)(R,{})})})]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(r,{sx:{flex:"1 1 100%"},variant:"h6",children:"Event Logs"}),(0,e.jsx)(g,{title:"Export CSV",children:(0,e.jsx)(b,{onClick:$,children:(0,e.jsx)(Q,{})})})]})}),(0,e.jsx)(Z,{children:(0,e.jsxs)(ce,{children:[(0,e.jsx)(ee,{children:(0,e.jsxs)(_,{children:[(0,e.jsx)(a,{padding:"checkbox",children:(0,e.jsx)(O,{indeterminate:T>0&&T<l.length,checked:l.length>0&&T===l.length,onChange:H})}),(0,e.jsx)(a,{children:"Time"}),(0,e.jsx)(a,{children:"Severity"}),(0,e.jsx)(a,{children:"Event Type"}),(0,e.jsx)(a,{children:"User"}),(0,e.jsx)(a,{children:"Description"}),(0,e.jsx)(a,{children:"Entity"}),(0,e.jsx)(a,{children:"Actions"})]})}),(0,e.jsx)(xe,{children:x?(0,e.jsx)(_,{children:(0,e.jsx)(a,{colSpan:8,align:"center",children:"Loading..."})}):l.length===0?(0,e.jsx)(_,{children:(0,e.jsx)(a,{colSpan:8,align:"center",children:"No event logs found"})}):l.map(s=>{const d=X(s.id);return(0,e.jsxs)(_,{hover:!0,selected:d,children:[(0,e.jsx)(a,{padding:"checkbox",children:(0,e.jsx)(O,{checked:d,onChange:()=>V(s.id)})}),(0,e.jsx)(a,{children:(0,e.jsx)(r,{variant:"body2",noWrap:!0,children:I(new Date(s.createdAt),"MMM d, HH:mm:ss")})}),(0,e.jsx)(a,{children:(0,e.jsx)(M,{icon:q(s.severity),label:s.severity,color:K(s.severity),size:"small"})}),(0,e.jsx)(a,{children:(0,e.jsx)(r,{variant:"body2",noWrap:!0,children:L(s.eventType)})}),(0,e.jsx)(a,{children:(0,e.jsx)(r,{variant:"body2",noWrap:!0,children:s.user?.username||"System"})}),(0,e.jsx)(a,{children:(0,e.jsx)(r,{variant:"body2",noWrap:!0,sx:{maxWidth:300},children:s.description})}),(0,e.jsx)(a,{children:(0,e.jsx)(r,{variant:"body2",noWrap:!0,children:s.entityType||"-"})}),(0,e.jsx)(a,{children:(0,e.jsxs)(n,{sx:{display:"flex",gap:.5},children:[t&&(0,e.jsx)(g,{title:"View Details",children:(0,e.jsx)(b,{size:"small",onClick:()=>t(s),children:(0,e.jsx)(te,{fontSize:"small"})})}),(0,e.jsx)(g,{title:"Delete",children:(0,e.jsx)(b,{size:"small",color:"error",onClick:()=>G(s.id),children:(0,e.jsx)(R,{fontSize:"small"})})})]})})]},s.id)})})]})}),(0,e.jsx)(ne,{rowsPerPageOptions:[25,50,100,200],component:"div",count:m.total,rowsPerPage:j,page:c,onPageChange:(s,d)=>f(d),onRowsPerPageChange:s=>{v(parseInt(s.target.value,10)),f(0)}})]})};var D=({children:t,value:o,index:i,...l})=>(0,e.jsx)("div",{role:"tabpanel",hidden:o!==i,...l,children:o===i&&(0,e.jsx)(n,{sx:{py:2},children:t})});const fe=({eventLog:t,open:o,onClose:i,onDelete:l})=>{const[x,m]=(0,p.useState)(0);if(!t)return null;const h=c=>{switch(c){case"INFO":return"info";case"WARNING":return"warning";case"ERROR":return"error";case"CRITICAL":return"error";default:return"default"}},u=c=>{switch(c){case"INFO":return(0,e.jsx)(E,{});case"WARNING":return(0,e.jsx)(k,{});case"ERROR":return(0,e.jsx)(z,{});case"CRITICAL":return(0,e.jsx)(F,{});default:return(0,e.jsx)(E,{})}};return(0,e.jsxs)(re,{open:o,onClose:i,maxWidth:"md",fullWidth:!0,children:[(0,e.jsx)(ue,{children:(0,e.jsxs)(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,e.jsxs)(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,e.jsx)(r,{variant:"h6",children:"Event Log Details"}),(0,e.jsx)(M,{icon:u(t.severity),label:t.severity,color:h(t.severity),size:"small"})]}),(0,e.jsx)(b,{onClick:i,size:"small",children:(0,e.jsx)(de,{})})]})}),(0,e.jsx)(se,{}),(0,e.jsxs)(ae,{children:[(0,e.jsxs)(oe,{value:x,onChange:(c,f)=>m(f),children:[(0,e.jsx)(A,{label:"Overview"}),(0,e.jsx)(A,{label:"Metadata"}),(0,e.jsx)(A,{label:"Technical"})]}),(0,e.jsx)(D,{value:x,index:0,children:(0,e.jsxs)(n,{sx:{display:"grid",gap:2},children:[(0,e.jsxs)(n,{children:[(0,e.jsx)(r,{variant:"body2",color:"text.secondary",children:"Event Type"}),(0,e.jsx)(r,{variant:"body1",children:t.eventType.replace(/_/g," ")})]}),(0,e.jsxs)(n,{children:[(0,e.jsx)(r,{variant:"body2",color:"text.secondary",children:"Description"}),(0,e.jsx)(r,{variant:"body1",children:t.description})]}),(0,e.jsxs)(n,{children:[(0,e.jsx)(r,{variant:"body2",color:"text.secondary",children:"User"}),(0,e.jsx)(r,{variant:"body1",children:t.user?(0,e.jsxs)(e.Fragment,{children:[t.user.username," (",t.user.email,")"]}):"System"})]}),(0,e.jsxs)(n,{children:[(0,e.jsx)(r,{variant:"body2",color:"text.secondary",children:"Time"}),(0,e.jsx)(r,{variant:"body1",children:I(new Date(t.createdAt),"MMMM d, yyyy HH:mm:ss")})]}),t.entityType&&(0,e.jsxs)(n,{children:[(0,e.jsx)(r,{variant:"body2",color:"text.secondary",children:"Entity"}),(0,e.jsxs)(r,{variant:"body1",children:[t.entityType,t.entityId&&(0,e.jsxs)(r,{component:"span",sx:{ml:1,fontFamily:"monospace",fontSize:"0.875rem"},children:["(",t.entityId,")"]})]})]})]})}),(0,e.jsx)(D,{value:x,index:1,children:t.metadata?(0,e.jsx)(n,{sx:{backgroundColor:"grey.50",p:2,borderRadius:1,maxHeight:400,overflow:"auto"},children:(0,e.jsx)("pre",{style:{margin:0,fontSize:"0.875rem",fontFamily:"monospace"},children:JSON.stringify(t.metadata,null,2)})}):(0,e.jsx)(r,{color:"text.secondary",children:"No metadata available"})}),(0,e.jsx)(D,{value:x,index:2,children:(0,e.jsxs)(n,{sx:{display:"grid",gap:2},children:[(0,e.jsxs)(n,{children:[(0,e.jsx)(r,{variant:"body2",color:"text.secondary",children:"Event ID"}),(0,e.jsx)(r,{variant:"body1",sx:{fontFamily:"monospace",fontSize:"0.875rem"},children:t.id})]}),t.ipAddress&&(0,e.jsxs)(n,{children:[(0,e.jsx)(r,{variant:"body2",color:"text.secondary",children:"IP Address"}),(0,e.jsx)(r,{variant:"body1",sx:{fontFamily:"monospace",fontSize:"0.875rem"},children:t.ipAddress})]}),t.userAgent&&(0,e.jsxs)(n,{children:[(0,e.jsx)(r,{variant:"body2",color:"text.secondary",children:"User Agent"}),(0,e.jsx)(r,{variant:"body2",sx:{wordBreak:"break-word"},children:t.userAgent})]}),t.userId&&(0,e.jsxs)(n,{children:[(0,e.jsx)(r,{variant:"body2",color:"text.secondary",children:"User ID"}),(0,e.jsx)(r,{variant:"body1",sx:{fontFamily:"monospace",fontSize:"0.875rem"},children:t.userId})]})]})})]}),(0,e.jsxs)(J,{children:[l&&(0,e.jsx)(U,{startIcon:(0,e.jsx)(R,{}),color:"error",onClick:()=>l(t.id),children:"Delete"}),(0,e.jsx)(U,{onClick:i,variant:"contained",children:"Close"})]})]})};var me=fe;function Ce(){const t=W(),{success:o,error:i}=ye(),[l,x]=(0,p.useState)(null),[m,h]=(0,p.useState)(!1),u=j=>{x(j),h(!0)},c=async j=>{try{await t(w(j)).unwrap(),o("Event log deleted successfully")}catch(v){i("Failed to delete event log"),console.error("Delete event log error:",v)}},f=()=>{h(!1),x(null)};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(pe,{onView:u,onDelete:c}),l&&(0,e.jsx)(me,{eventLog:l,open:m,onClose:f})]})}export{Ce as default};
