import{r as V}from"./rolldown-runtime-CjiBMUN4.js";import{Cn as ee}from"./vendor-BM98ZQOm.js";import"./vendor-charts-C1uJw4t_.js";import"./vendor-utils-BBFcn-gs.js";import{$n as se,$r as n,Hr as te,Kn as re,Kr as U,Kt as le,Qn as ne,Rr as ae,U as ie,Ur as oe,V as W,Vr as ce,Vt as I,Xn as de,Yn as w,Zn as xe,Zr as k,ai as r,dr as R,er as l,f as D,fi as ue,hn as he,ln as O,nr as je,oi as E,qn as fe,ri as b,rr as L,si as C,tn as T,tr as me,vi as ye,vn as P,zr as ve}from"./vendor-mui-B1q6pdKu.js";import{A as F,O as H,k as N,n as pe,t as B}from"./index-Bv4sL6jZ.js";import{t as ge}from"./useNotification-CDDMP1HV.js";var y=V(ee()),e=V(ye());const Ce=({onView:t,onResolve:u,onDelete:o})=>{const a=B(),{conflicts:i,loading:f,pagination:p}=pe(s=>s.conflicts),[j,h]=(0,y.useState)([]),[m,g]=(0,y.useState)(0),[c,d]=(0,y.useState)(25);(0,y.useEffect)(()=>{a(N({page:m+1,limit:c}))},[a,m,c]);const M=s=>{s.target.checked?h(i.map(x=>x.id)):h([])},$=s=>{h(x=>x.includes(s)?x.filter(S=>S!==s):[...x,s])},q=async()=>{window.confirm(`Delete ${j.length} conflicts?`)&&(await Promise.all(j.map(s=>a(H(s)))),h([]),a(N({page:m+1,limit:c})))},G=async s=>{await a(F({id:s})),u&&u(s)},K=async s=>{window.confirm("Delete this conflict?")&&(await a(H(s)),o&&o(s))},Y=()=>{const s=[["ID","Type","Severity","Description","Conflict Time","Resolved","Created At"].join(","),...i.map(v=>[v.id,v.conflictType,v.severity,`"${v.description.replace(/"/g,'""')}"`,v.conflictTime,v.resolved?"Yes":"No",v.createdAt].join(","))].join(`
`),x=new Blob([s],{type:"text/csv"}),S=URL.createObjectURL(x),A=document.createElement("a");A.href=S,A.download=`conflicts-${D(new Date,"yyyy-MM-dd")}.csv`,A.click(),URL.revokeObjectURL(S)},J=s=>{switch(s){case"LOW":return"info";case"MEDIUM":return"warning";case"HIGH":return"error";case"CRITICAL":return"error";default:return"default"}},X=s=>{switch(s){case"LOW":return(0,e.jsx)(I,{fontSize:"small"});case"MEDIUM":return(0,e.jsx)(W,{fontSize:"small"});case"HIGH":return(0,e.jsx)(T,{fontSize:"small"});case"CRITICAL":return(0,e.jsx)(T,{fontSize:"small"});default:return(0,e.jsx)(I,{fontSize:"small"})}},Z=s=>{switch(s){case"RESOURCE_OVERLAP":return"ðŸ”§ Resource Overlap";case"TIME_OVERLAP":return"â° Time Overlap";case"LOCATION_OVERLAP":return"ðŸ“ Location Overlap";case"CAPACITY_EXCEEDED":return"ðŸ“Š Capacity Exceeded";default:return s}},Q=s=>j.includes(s),_=j.length;return(0,e.jsxs)(ue,{children:[(0,e.jsx)(xe,{sx:{pl:{sm:2},pr:{xs:1,sm:1}},children:_>0?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(r,{sx:{flex:"1 1 100%"},color:"inherit",variant:"subtitle1",children:[_," selected"]}),(0,e.jsx)(R,{title:"Delete",children:(0,e.jsx)(C,{onClick:q,children:(0,e.jsx)(O,{})})})]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(r,{sx:{flex:"1 1 100%"},variant:"h6",children:"Conflicts"}),(0,e.jsx)(R,{title:"Export CSV",children:(0,e.jsx)(C,{onClick:Y,children:(0,e.jsx)(le,{})})})]})}),i.some(s=>s.severity==="CRITICAL"&&!s.resolved)&&(0,e.jsxs)(E,{severity:"error",sx:{m:2},children:[(0,e.jsx)("strong",{children:"Critical Conflicts Detected!"})," Immediate attention required for"," ",i.filter(s=>s.severity==="CRITICAL"&&!s.resolved).length," critical conflicts."]}),(0,e.jsx)(se,{children:(0,e.jsxs)(je,{children:[(0,e.jsx)(ne,{children:(0,e.jsxs)(w,{children:[(0,e.jsx)(l,{padding:"checkbox",children:(0,e.jsx)(U,{indeterminate:_>0&&_<i.length,checked:i.length>0&&_===i.length,onChange:M})}),(0,e.jsx)(l,{children:"Severity"}),(0,e.jsx)(l,{children:"Type"}),(0,e.jsx)(l,{children:"Description"}),(0,e.jsx)(l,{children:"Conflict Time"}),(0,e.jsx)(l,{children:"Status"}),(0,e.jsx)(l,{children:"Actions"})]})}),(0,e.jsx)(me,{children:f?(0,e.jsx)(w,{children:(0,e.jsx)(l,{colSpan:7,align:"center",children:"Loading..."})}):i.length===0?(0,e.jsx)(w,{children:(0,e.jsx)(l,{colSpan:7,align:"center",children:"No conflicts found"})}):i.map(s=>{const x=Q(s.id);return(0,e.jsxs)(w,{hover:!0,selected:x,children:[(0,e.jsx)(l,{padding:"checkbox",children:(0,e.jsx)(U,{checked:x,onChange:()=>$(s.id)})}),(0,e.jsx)(l,{children:(0,e.jsx)(b,{icon:X(s.severity),label:s.severity,color:J(s.severity),size:"small"})}),(0,e.jsx)(l,{children:Z(s.conflictType)}),(0,e.jsx)(l,{children:(0,e.jsx)(r,{variant:"body2",noWrap:!0,sx:{maxWidth:300},children:s.description})}),(0,e.jsx)(l,{children:D(new Date(s.conflictTime),"MMM d, yyyy HH:mm")}),(0,e.jsx)(l,{children:s.resolved?(0,e.jsx)(b,{label:"Resolved",color:"success",size:"small"}):(0,e.jsx)(b,{label:"Unresolved",color:"warning",size:"small"})}),(0,e.jsx)(l,{children:(0,e.jsxs)(n,{sx:{display:"flex",gap:.5},children:[t&&(0,e.jsx)(R,{title:"View Details",children:(0,e.jsx)(C,{size:"small",onClick:()=>t(s),children:(0,e.jsx)(ie,{fontSize:"small"})})}),!s.resolved&&(0,e.jsx)(R,{title:"Resolve",children:(0,e.jsx)(C,{size:"small",color:"success",onClick:()=>G(s.id),children:(0,e.jsx)(P,{fontSize:"small"})})}),(0,e.jsx)(R,{title:"Delete",children:(0,e.jsx)(C,{size:"small",color:"error",onClick:()=>K(s.id),children:(0,e.jsx)(O,{fontSize:"small"})})})]})})]},s.id)})})]})}),(0,e.jsx)(de,{rowsPerPageOptions:[10,25,50,100],component:"div",count:p.total,rowsPerPage:c,page:m,onPageChange:(s,x)=>g(x),onRowsPerPageChange:s=>{d(parseInt(s.target.value,10)),g(0)}})]})};var z=({children:t,value:u,index:o,...a})=>(0,e.jsx)("div",{role:"tabpanel",hidden:u!==o,...a,children:u===o&&(0,e.jsx)(n,{sx:{py:2},children:t})});const be=({conflict:t,open:u,onClose:o,onResolve:a,onDelete:i})=>{const[f,p]=(0,y.useState)(0),[j,h]=(0,y.useState)("");if(!t)return null;const m=d=>{switch(d){case"LOW":return"info";case"MEDIUM":return"warning";case"HIGH":return"error";case"CRITICAL":return"error";default:return"default"}},g=d=>{switch(d){case"LOW":return(0,e.jsx)(I,{});case"MEDIUM":return(0,e.jsx)(W,{});case"HIGH":return(0,e.jsx)(T,{});case"CRITICAL":return(0,e.jsx)(T,{});default:return(0,e.jsx)(I,{})}},c=()=>{a&&(a(t.id,j||void 0),h(""))};return(0,e.jsxs)(oe,{open:u,onClose:o,maxWidth:"md",fullWidth:!0,children:[(0,e.jsx)(ve,{children:(0,e.jsxs)(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,e.jsxs)(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,e.jsx)(r,{variant:"h6",children:"Conflict Details"}),(0,e.jsx)(b,{icon:g(t.severity),label:t.severity,color:m(t.severity),size:"small"}),t.resolved?(0,e.jsx)(b,{label:"Resolved",color:"success",size:"small"}):(0,e.jsx)(b,{label:"Unresolved",color:"warning",size:"small"})]}),(0,e.jsx)(C,{onClick:o,size:"small",children:(0,e.jsx)(he,{})})]})}),(0,e.jsx)(ae,{}),(0,e.jsxs)(ce,{children:[t.severity==="CRITICAL"&&!t.resolved&&(0,e.jsxs)(E,{severity:"error",icon:(0,e.jsx)(T,{}),sx:{mb:2},children:[(0,e.jsx)("strong",{children:"Critical Conflict!"})," This requires immediate attention and resolution."]}),(0,e.jsxs)(fe,{value:f,onChange:(d,M)=>p(M),children:[(0,e.jsx)(L,{label:"Overview"}),(0,e.jsx)(L,{label:"Affected Resources"}),(0,e.jsx)(L,{label:"Resolution"})]}),(0,e.jsx)(z,{value:f,index:0,children:(0,e.jsxs)(n,{sx:{display:"grid",gap:2},children:[(0,e.jsxs)(n,{children:[(0,e.jsx)(r,{variant:"body2",color:"text.secondary",children:"Conflict Type"}),(0,e.jsx)(r,{variant:"body1",children:t.conflictType.replace("_"," ")})]}),(0,e.jsxs)(n,{children:[(0,e.jsx)(r,{variant:"body2",color:"text.secondary",children:"Description"}),(0,e.jsx)(r,{variant:"body1",children:t.description})]}),(0,e.jsxs)(n,{children:[(0,e.jsx)(r,{variant:"body2",color:"text.secondary",children:"Conflict Time"}),(0,e.jsx)(r,{variant:"body1",children:D(new Date(t.conflictTime),"MMMM d, yyyy HH:mm:ss")})]}),(0,e.jsxs)(n,{children:[(0,e.jsx)(r,{variant:"body2",color:"text.secondary",children:"Simulation Run ID"}),(0,e.jsx)(r,{variant:"body1",sx:{fontFamily:"monospace",fontSize:"0.875rem"},children:t.simulationRunId})]}),(0,e.jsxs)(n,{children:[(0,e.jsx)(r,{variant:"body2",color:"text.secondary",children:"Created At"}),(0,e.jsx)(r,{variant:"body1",children:D(new Date(t.createdAt),"MMMM d, yyyy HH:mm:ss")})]})]})}),(0,e.jsx)(z,{value:f,index:1,children:(0,e.jsx)(n,{sx:{backgroundColor:"grey.50",p:2,borderRadius:1,maxHeight:400,overflow:"auto"},children:(0,e.jsx)("pre",{style:{margin:0,fontSize:"0.875rem",fontFamily:"monospace"},children:JSON.stringify(t.affectedResources,null,2)})})}),(0,e.jsx)(z,{value:f,index:2,children:(0,e.jsxs)(n,{sx:{display:"grid",gap:2},children:[t.suggestedResolution&&(0,e.jsxs)(n,{children:[(0,e.jsx)(r,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Suggested Resolution"}),(0,e.jsx)(n,{sx:{backgroundColor:"info.lighter",p:2,borderRadius:1,border:1,borderColor:"info.main"},children:(0,e.jsx)("pre",{style:{margin:0,fontSize:"0.875rem",fontFamily:"monospace"},children:JSON.stringify(t.suggestedResolution,null,2)})})]}),t.resolved&&t.resolutionNotes&&(0,e.jsxs)(n,{children:[(0,e.jsx)(r,{variant:"body2",color:"text.secondary",children:"Resolution Notes"}),(0,e.jsx)(E,{severity:"success",icon:(0,e.jsx)(P,{}),children:t.resolutionNotes})]}),!t.resolved&&(0,e.jsxs)(n,{children:[(0,e.jsx)(r,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Add Resolution Notes"}),(0,e.jsx)(re,{fullWidth:!0,multiline:!0,rows:4,placeholder:"Describe how this conflict was resolved...",value:j,onChange:d=>h(d.target.value),variant:"outlined"})]})]})})]}),(0,e.jsxs)(te,{children:[!t.resolved&&a&&(0,e.jsx)(k,{startIcon:(0,e.jsx)(P,{}),color:"success",onClick:c,variant:"contained",children:"Mark as Resolved"}),i&&(0,e.jsx)(k,{startIcon:(0,e.jsx)(O,{}),color:"error",onClick:()=>i(t.id),children:"Delete"}),(0,e.jsx)(k,{onClick:o,children:"Close"})]})]})};var _e=be;function Ae(){const t=B(),{success:u,error:o}=ge(),[a,i]=(0,y.useState)(null),[f,p]=(0,y.useState)(!1),j=c=>{i(c),p(!0)},h=async c=>{try{await t(F({id:c})).unwrap(),u("Conflict resolved successfully")}catch(d){o("Failed to resolve conflict"),console.error("Resolve conflict error:",d)}},m=async c=>{try{await t(H(c)).unwrap(),u("Conflict deleted successfully")}catch(d){o("Failed to delete conflict"),console.error("Delete conflict error:",d)}},g=()=>{p(!1),i(null)};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ce,{onView:j,onResolve:h,onDelete:m}),a&&(0,e.jsx)(_e,{conflict:a,open:f,onClose:g,onResolve:h})]})}export{Ae as default};
