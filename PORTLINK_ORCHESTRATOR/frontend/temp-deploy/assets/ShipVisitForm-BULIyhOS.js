import{r as I}from"./rolldown-runtime-CjiBMUN4.js";import{Cn as L,_t as o,bt as l,ft as k,gt as q,ht as D,mt as R,xt as F,yt as w}from"./vendor-BM98ZQOm.js";import"./vendor-charts-C1uJw4t_.js";import{c as G,l as Q}from"./vendor-react-BH1SDbH3.js";import"./vendor-utils-BBFcn-gs.js";import{$r as d,Br as M,Fn as $,Hr as z,Kn as n,Nt as H,Rr as T,Ur as Y,Vr as K,Yr as C,Zr as h,ai as x,br as c,ci as Z,d as J,n as P,oi as X,qr as b,si as ee,sn as re,t as ae,ut as se,vi as te,wn as ie,xn as le,zr as ne}from"./vendor-mui-B1q6pdKu.js";import{G as oe,H as ue,U as de,n as ce,t as ge,tt as me}from"./index-Bv4sL6jZ.js";var m=I(L()),e=I(te()),pe=R().shape({shipName:o().required("Ship name is required"),imoNumber:o().required("IMO number is required").matches(/^\d{7}$/,"IMO must be exactly 7 digits"),vesselType:o().required("Vessel type is required"),flag:o().required("Flag is required"),grossTonnage:q().typeError("Gross tonnage must be a number").positive("Gross tonnage must be positive").required("Gross tonnage is required"),visitPurpose:o().required("Visit purpose is required"),eta:D().required("ETA is required").nullable(),etd:D().required("ETD is required").nullable().min(w("eta"),"ETD must be after ETA"),status:o().required("Status is required"),cargoType:o().defined(),cargoQuantity:q().typeError("Cargo quantity must be a number").positive().nullable().defined(),cargoUnit:o().defined(),specialNotes:o().defined(),agentCompany:o().defined(),agentContact:o().defined()}),he=["Container Ship","Bulk Carrier","Tanker","General Cargo","Ro-Ro","Passenger Ship","Fishing Vessel","Other"],xe=["Loading","Unloading","Loading/Unloading","Bunkering","Repair","Crew Change","Transit","Other"],fe=[{value:"PLANNED",label:"Planned"},{value:"ARRIVED",label:"Arrived"},{value:"IN_PROGRESS",label:"In Progress"},{value:"COMPLETED",label:"Completed"},{value:"DEPARTED",label:"Departed"},{value:"CANCELLED",label:"Cancelled"}],je=["Container","Bulk Cargo","Liquid Bulk","General Cargo","Refrigerated","Hazardous","Vehicles","Livestock","Other"],ve=["Tons","TEU","Cubic Meters","Units","Barrels","Kilograms"],Te=()=>{const{id:p}=Q(),f=G(),g=ge(),u=!!p,[A,V]=(0,m.useState)(!1),[U,j]=(0,m.useState)(!1),{currentShipVisit:t,loading:v,error:y}=ce(r=>r.shipVisits),{control:i,handleSubmit:B,reset:S,formState:{errors:a,isDirty:_}}=F({resolver:k(pe),defaultValues:{shipName:"",imoNumber:"",vesselType:"",flag:"",grossTonnage:0,visitPurpose:"",eta:null,etd:null,status:"PLANNED",cargoType:"",cargoQuantity:null,cargoUnit:"Tons",specialNotes:"",agentCompany:"",agentContact:""}});(0,m.useEffect)(()=>(u&&p&&g(oe(p)),()=>{g(ue())}),[g,p,u]),(0,m.useEffect)(()=>{u&&t&&S({shipName:t.shipName,imoNumber:t.imoNumber,vesselType:t.vesselType,flag:t.flag,grossTonnage:t.grossTonnage,visitPurpose:t.visitPurpose,eta:t.eta?new Date(t.eta):null,etd:t.etd?new Date(t.etd):null,status:t.status,cargoType:t.cargoType||"",cargoQuantity:t.cargoQuantity||null,cargoUnit:t.cargoUnit||"Tons",specialNotes:t.specialNotes||"",agentCompany:t.agentCompany||"",agentContact:t.agentContact||""})},[u,t,S]),(0,m.useEffect)(()=>{V(_)},[_]);const O=async r=>{try{const s={...r,eta:r.eta?r.eta.toISOString():"",etd:r.etd?r.etd.toISOString():"",status:r.status,cargoQuantity:r.cargoQuantity??void 0};u&&t?await g(me({id:t.id,data:s})):await g(de(s)),f("/ship-visits")}catch(s){console.error("Failed to save ship visit:",s)}},N=()=>{A?j(!0):f("/ship-visits")},W=()=>{j(!1),f("/ship-visits")},E=()=>{j(!1)};return v&&u?(0,e.jsx)(d,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:(0,e.jsx)(Z,{})}):(0,e.jsx)(J,{dateAdapter:ae,children:(0,e.jsxs)(d,{sx:{p:3},children:[(0,e.jsxs)(d,{sx:{mb:3,display:"flex",alignItems:"center",gap:2},children:[(0,e.jsx)(ee,{onClick:N,sx:{mr:1},children:(0,e.jsx)($,{})}),(0,e.jsx)(x,{variant:"h4",children:u?"Edit Ship Visit":"New Ship Visit"})]}),y&&(0,e.jsx)(X,{severity:"error",sx:{mb:3},children:y}),(0,e.jsxs)("form",{onSubmit:B(O),children:[(0,e.jsx)(C,{sx:{mb:3},children:(0,e.jsxs)(b,{children:[(0,e.jsxs)(x,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[(0,e.jsx)(re,{}),"Ship Information"]}),(0,e.jsx)(T,{sx:{mb:3}}),(0,e.jsxs)(d,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)"},gap:2},children:[(0,e.jsx)(l,{name:"shipName",control:i,render:({field:r})=>(0,e.jsx)(n,{...r,label:"Ship Name",required:!0,error:!!a.shipName,helperText:a.shipName?.message,fullWidth:!0})}),(0,e.jsx)(l,{name:"imoNumber",control:i,render:({field:r})=>(0,e.jsx)(n,{...r,label:"IMO Number",required:!0,placeholder:"1234567",error:!!a.imoNumber,helperText:a.imoNumber?.message,fullWidth:!0})}),(0,e.jsx)(l,{name:"vesselType",control:i,render:({field:r})=>(0,e.jsx)(n,{...r,select:!0,label:"Vessel Type",required:!0,error:!!a.vesselType,helperText:a.vesselType?.message,fullWidth:!0,children:he.map(s=>(0,e.jsx)(c,{value:s,children:s},s))})}),(0,e.jsx)(l,{name:"flag",control:i,render:({field:r})=>(0,e.jsx)(n,{...r,label:"Flag",required:!0,placeholder:"e.g., Panama, Liberia",error:!!a.flag,helperText:a.flag?.message,fullWidth:!0})}),(0,e.jsx)(l,{name:"grossTonnage",control:i,render:({field:r})=>(0,e.jsx)(n,{...r,label:"Gross Tonnage",type:"number",required:!0,error:!!a.grossTonnage,helperText:a.grossTonnage?.message,fullWidth:!0})}),(0,e.jsx)(l,{name:"agentCompany",control:i,render:({field:r})=>(0,e.jsx)(n,{...r,label:"Agent Company",error:!!a.agentCompany,helperText:a.agentCompany?.message,fullWidth:!0})}),(0,e.jsx)(l,{name:"agentContact",control:i,render:({field:r})=>(0,e.jsx)(n,{...r,label:"Agent Contact",placeholder:"Email or Phone",error:!!a.agentContact,helperText:a.agentContact?.message,fullWidth:!0})})]})]})}),(0,e.jsx)(C,{sx:{mb:3},children:(0,e.jsxs)(b,{children:[(0,e.jsxs)(x,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[(0,e.jsx)(ie,{}),"Visit Details"]}),(0,e.jsx)(T,{sx:{mb:3}}),(0,e.jsxs)(d,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)"},gap:2},children:[(0,e.jsx)(l,{name:"visitPurpose",control:i,render:({field:r})=>(0,e.jsx)(n,{...r,select:!0,label:"Visit Purpose",required:!0,error:!!a.visitPurpose,helperText:a.visitPurpose?.message,fullWidth:!0,children:xe.map(s=>(0,e.jsx)(c,{value:s,children:s},s))})}),(0,e.jsx)(l,{name:"status",control:i,render:({field:r})=>(0,e.jsx)(n,{...r,select:!0,label:"Status",required:!0,error:!!a.status,helperText:a.status?.message,fullWidth:!0,children:fe.map(s=>(0,e.jsx)(c,{value:s.value,children:s.label},s.value))})}),(0,e.jsx)(l,{name:"eta",control:i,render:({field:r})=>(0,e.jsx)(P,{...r,label:"ETA (Estimated Time of Arrival)",slotProps:{textField:{required:!0,error:!!a.eta,helperText:a.eta?.message,fullWidth:!0}}})}),(0,e.jsx)(l,{name:"etd",control:i,render:({field:r})=>(0,e.jsx)(P,{...r,label:"ETD (Estimated Time of Departure)",slotProps:{textField:{required:!0,error:!!a.etd,helperText:a.etd?.message,fullWidth:!0}}})})]})]})}),(0,e.jsx)(C,{sx:{mb:3},children:(0,e.jsxs)(b,{children:[(0,e.jsxs)(x,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[(0,e.jsx)(H,{}),"Cargo Information"]}),(0,e.jsx)(T,{sx:{mb:3}}),(0,e.jsxs)(d,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)"},gap:2},children:[(0,e.jsx)(l,{name:"cargoType",control:i,render:({field:r})=>(0,e.jsxs)(n,{...r,select:!0,label:"Cargo Type",error:!!a.cargoType,helperText:a.cargoType?.message,fullWidth:!0,children:[(0,e.jsx)(c,{value:"",children:(0,e.jsx)("em",{children:"None"})}),je.map(s=>(0,e.jsx)(c,{value:s,children:s},s))]})}),(0,e.jsx)(l,{name:"cargoUnit",control:i,render:({field:r})=>(0,e.jsx)(n,{...r,select:!0,label:"Cargo Unit",error:!!a.cargoUnit,helperText:a.cargoUnit?.message,fullWidth:!0,children:ve.map(s=>(0,e.jsx)(c,{value:s,children:s},s))})}),(0,e.jsx)(l,{name:"cargoQuantity",control:i,render:({field:r})=>(0,e.jsx)(n,{...r,value:r.value||"",label:"Cargo Quantity",type:"number",error:!!a.cargoQuantity,helperText:a.cargoQuantity?.message,fullWidth:!0})}),(0,e.jsx)(l,{name:"specialNotes",control:i,render:({field:r})=>(0,e.jsx)(n,{...r,label:"Special Notes",multiline:!0,rows:3,error:!!a.specialNotes,helperText:a.specialNotes?.message,fullWidth:!0,sx:{gridColumn:{xs:"1",sm:"1 / -1"}}})})]})]})}),(0,e.jsxs)(d,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[(0,e.jsx)(h,{variant:"outlined",startIcon:(0,e.jsx)(le,{}),onClick:N,size:"large",children:"Cancel"}),(0,e.jsx)(h,{type:"submit",variant:"contained",startIcon:(0,e.jsx)(se,{}),disabled:v,size:"large",children:v?"Saving...":u?"Update":"Create"})]})]}),(0,e.jsxs)(Y,{open:U,onClose:E,"aria-labelledby":"cancel-dialog-title",children:[(0,e.jsx)(ne,{id:"cancel-dialog-title",children:"Unsaved Changes"}),(0,e.jsx)(K,{children:(0,e.jsx)(M,{children:"You have unsaved changes. Are you sure you want to leave without saving?"})}),(0,e.jsxs)(z,{children:[(0,e.jsx)(h,{onClick:E,children:"Stay"}),(0,e.jsx)(h,{onClick:W,color:"error",variant:"contained",children:"Leave"})]})]})]})})},qe=Te;export{qe as default};
